---
title: "Capstone Project"
author: "Eric Kao"
date: "March 26, 2017"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(dplyr)
library(plyr)
#preload all the dataframe
math <-read.csv('student-mat.csv')##math class grade
portuguese <-read.csv('student-por.csv')##portugese

join_set=merge(math,portuguese,by=c("school","sex","age","address","famsize","Pstatus", "Medu","Fedu","Mjob","Fjob","reason","nursery","internet", "guardian","guardian","traveltime","studytime","failures", "schoolsup","famsup","activities","higher","romantic", "famrel","freetime","goout","Dalc","Walc","health","absences"))



```

## Student Alcohol Consumption

**Student Alcohol Consumption** dataset is what I decided for my springboard capstone project. You can find the original dataset at [here](https://www.kaggle.com/uciml/student-alcohol-consumption)

Let's take a first look of the dataset.

```{r}

str(join_set)

```



## Including Plots

###Data wrangling

I create grade_mean_portuguese and grade_mean_math to record the average of the student and create another column total_mean to record the average of grade_mean_math and grade_mean_portuguese.

```{r}
library(ggplot2)
join_set<-join_set%>%mutate(grade_mean_math=(G1.x+G2.x+G3.x)/3)%>%mutate(grade_mean_portuguese=(G1.y+G2.y+G3.y)/3)%>%mutate(total_mean = ((grade_mean_math+grade_mean_portuguese)/2) )
```

Next, I change Dalc and Walc into text in order to read the value easier. 
```{r}
join_set$Dalc <- mapvalues(join_set$Dalc, from = 1:5, to = c("Very Low", "Low", "Medium", "High", "Very High"))
join_set$Walc <- mapvalues(join_set$Dalc, from = 1:5, to = c("Very Low", "Low", "Medium", "High", "Very High"))

```

When I do this I notice the there is no "High" and "Very high" in the data set. 


Let's see the gender structure of this sample.
```{r}
ggplot(join_set, aes(x=sex,col=sex,fill=sex))+geom_bar(position= "dodge")
```
In this sample, there are 50 females and 35 males. 



```{r}
Dalc_total_mean<-ggplot(join_set,aes(x=reorder(Dalc,total_mean, order = FALSE),y= total_mean))
Dalc_total_mean+geom_boxplot()+labs(x="Workday Alcohol Consumption")
```


From this plot, the group that consume "Medium" alcohol have a lower median then other 2 groups. The "Median" group also have a lower average than other 2 groups. 

```{r}
Dalc_total_mean+geom_jitter(aes(col= sex))+ggtitle("Student total_mean distribution dotplot based on Workday alcohol consumption")+labs(x="Workday Alcohol Consumption")
```

```{r}
ggplot(join_set,aes(x=sex,col=sex))+geom_bar(position="dodge",aes(fill=sex))+facet_grid(. ~ reorder(Dalc,total_mean, order = FALSE))+ggtitle("Student headcount of each Workday alcohol consumption group")
```
Most of female students are in the "Very Low" group and there is no female students in "Medium" group. 




```{r}
ggplot(join_set ,aes(x=total_mean, y=total_mean,col=Dalc))+geom_jitter()


```

```{r}
Walc_total_mean = ggplot(join_set,aes(x=reorder(Walc,total_mean, order = FALSE),y= total_mean))
Walc_total_mean + geom_boxplot()+labs(x="Workday Alcohol Consumption")
```
The distribution of gender between schools are the same. 


```{r}

#why this is not woring in here
base1_class_sex<-ggplot(math,aes(x=school, col=sex))
base1_class_sex+geom_bar(aes(fill=sex),stat="count",position = "fill")+facet_grid(.~Dalc)+ggtitle("Gender Proportion of each group")

```
Gender proportion of each daily consumption group. Male tends to drink more alcohol than female. 



set up the test set and training set.

```{r}
library(caTools)
set.seed(144)
split = sample.split(join_set$total_mean, SplitRatio = 0.65)
train = subset(join_set,split==TRUE)
test = subset(join_set,split==FALSE)
```


### Do the linear regression first
```{r}
Train.lm = lm(train$total_mean ~.-G1.x-G2.x-G3.x-G1.y-G2.y-G3.y-grade_mean_math-grade_mean_portuguese,data=train)
summary(mathlm)

```



Third, use the model to predict the test model

```{r}

```

##Random Forest
```{r}
library(randomForest)
mathForest = randomForest(.-grade_mean-G1-G2-G3, data = train, nodesize= 25, ntree=200)
PredictForest = predict(mathForest,newdata = test)
table(test$pass_fail, PredictForest)
```

##Decision tree
```{r}
library(rpart)
library(rpart.plot)
mathTree = rpart(pass_fail~.-grade_mean-G1-G2-G3, data = train, method = "class", control = rpart.control(minbucket = 25))
prp(mathTree)

```


#Use avg grade

##Decision tree
```{r}
library(rpart)
library(rpart.plot)
mathavgTree = rpart(grade_mean~.-pass_fail-G1-G2-G3, data = train, control = rpart.control(minbucket = 25))
prp(mathavgTree)
##dont use method='method in rpart when you're building a regression model'
```


##Regression random forest
```{r}


```


use pass_fail:
logistic 
random forest 
decision tree

use avg grade:
use:
RMAC
decision tree 
regression random forest


